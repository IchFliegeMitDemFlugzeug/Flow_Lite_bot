# Импортируем модуль asyncio, чтобы запускать асинхронный код
import asyncio

# Импортируем тип Bot — объект, представляющий нашего Telegram-бота
# и умеющий отправлять сообщения, получать апдейты и т.п.
from aiogram import Bot, Dispatcher

# Импортируем функцию загрузки конфигурации бота (чтение токена из окружения)
from .config import load_bot_config

# Импортируем функцию, которая зарегистрирует все роутеры (сообщения) в диспетчере
from .routers import setup_routers


# Определяем асинхронную функцию main — точку входа приложения
async def main() -> None:
    """
    Основная функция запуска бота.

    1. Загружает конфигурацию (токен бота).
    2. Создаёт объект Bot.
    3. Создаёт Dispatcher.
    4. Подключает все роутеры (каждый роутер = набор сообщений/экранов).
    5. Запускает бесконечный опрос сервера Telegram (polling).
    """

    # Загружаем конфигурацию (внутри будет проверка, что BOT_TOKEN задан)
    config = load_bot_config()

    # Создаём объект бота, передавая ему токен из конфигурации
    bot: Bot = Bot(token=config.token)

    # Создаём объект диспетчера, который будет управлять всеми хэндлерами
    dp: Dispatcher = Dispatcher()

    # Передаём диспетчер в функцию setup_routers,
    # чтобы в нём зарегистрировались все роутеры из папки routers
    setup_routers(dp)

    # Запускаем бесконечный опрос сервера Telegram.
    # dp.start_polling будет получать все входящие апдейты (сообщения, команды и т.п.)
    # и передавать их обработчикам, которые мы зарегистрировали в роутерах.
    await dp.start_polling(bot)


# Этот блок выполнится только если файл main.py запустить напрямую как скрипт:
# python services/bot/main.py
if __name__ == "__main__":
    # Запускаем асинхронную функцию main() с помощью asyncio.run.
    # Это стандартный способ запуска "async def main()" в обычном Python-скрипте.
    asyncio.run(main())
