# Базовый образ: официальный Python с уменьшенным размером (slim-версия)
FROM python:3.11-slim

# Устанавливаем рабочую директорию внутри контейнера
# Все последующие команды будут выполняться относительно /app
WORKDIR /app

# Копируем файл с зависимостями из корня проекта (на хосте)
# в текущую директорию контейнера (/app/requirements.txt)
COPY requirements.txt ./requirements.txt

# Устанавливаем Python-зависимости внутри контейнера
# --no-cache-dir говорит pip не сохранять кэш пакетов, чтобы уменьшить размер образа
RUN pip install --no-cache-dir -r requirements.txt

# Копируем ВСЕ файлы проекта из текущей папки (context)
# в рабочую директорию контейнера (/app)
# Таким образом в контейнер попадут папки services, infra и др.
COPY . .

# Устанавливаем переменную окружения PYTHONUNBUFFERED,
# чтобы вывод (print, логи) сразу попадал в консоль без задержек
ENV PYTHONUNBUFFERED=1

# Указываем команду по умолчанию для контейнера:
# запускаем интерпретатор Python и файл services/bot/main.py
CMD ["python", "services/bot/main.py"]
