# Имя рабочего процесса, чтобы в интерфейсе GitHub было понятно, за что он отвечает.
name: "Deploy WebApp to GitHub Pages"

# Условия запуска: автоматически при пуше в ветку main и вручную через кнопку Run workflow.
on:
  push:
    branches:
      - main
  workflow_dispatch:

# Требуемые права: читаем код, пишем в GitHub Pages и используем OIDC-токен для деплоя.
permissions:
  contents: read
  pages: write
  id-token: write

# Одновременный запуск ограничиваем одним экземпляром, чтобы не столкнуться с конфликтами загрузок.
concurrency: pages

jobs:
  build:
    # Запускаем сборку на Ubuntu.
    runs-on: ubuntu-latest
    steps:
      # Клонируем репозиторий.
      - name: Checkout repository
        uses: actions/checkout@v4

      # Упаковываем статические файлы из services/WebApp в артефакт для GitHub Pages.
      - name: Upload WebApp artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: services/WebApp

  deploy:
    # Ждём окончания сборки.
    needs: build
    # Запускаем деплой на Ubuntu.
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    steps:
      # Разворачиваем артефакт на GitHub Pages.
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
